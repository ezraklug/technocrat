// ==== IMAGES ==== //

// To be applied to the container element around an image standing in for a link (e.g. post thumbnail, gallery item)
@mixin image-fade {
  backface-visibility: hidden; // Prevents flicker
  overflow: hidden;
  img {
    @include border-radius;
    display: block;
    transition: all .65s ease; // Can't transition "filter", probably because we'd have to add a bunch of vendor prefixes; let's just transition all
    width: 100%;
  }
  &:hover {
    cursor: pointer;
    img {
      backface-visibility: hidden;
      filter: brightness(70%) opacity(80%) grayscale(100%);
      transition: all .4s ease;
    }
  }
}



// Image fallback; a stylized placeholder for images that don't load or are slow to load
@mixin image-fallback {
  @include border-radius;
  background-color: colour(body-darker);
  background-image: repeating-linear-gradient( 45deg, transparent, transparent spacer(1/4), black(.04) spacer(1/4), black(.04) spacer(1/2) );
  box-shadow: 0 0 spacer(2) black(.1) inset;
  transition: background-color .8s ease-out, box-shadow 1.1s ease-in;
  &:hover {
    background-color: lighten( colour(body-darker), 7 );
    box-shadow: 0 0 spacer() black(.08) inset;
    transition: background-color .5s ease-in-out, box-shadow .3s ease;
  }
}



// Image overlay; used in gallery and thumbnail overlays
@mixin image-overlay($overlay: ".wp-caption", $style: title) {
  @include image-fade;
  position: relative;
  #{$overlay} {
    @include font-size(text-small);
    @if ($style == caption) {
      @include font-style(image-overlay-caption);
      text-align: left;
      text-shadow: 0px 1px 2px black(.8);
    }
    @if ($style == title) {
      @include k-media-above( break(medium) ) {
        .full-width & {
          @include rem( font-size, size(text-big) + 0px ); // Boost the font size on full-width displays
        }
      }
      @include font-style(image-overlay-title);
      text-align: center;
      text-shadow: 0px 1px 2px black(.8);
      // Note: bigger sizes and media queries have been moved to `_image.scss`
    }
    @include border-radius(0 0 $d-radius $d-radius);
    @include k-absolute(bottom 0 left 0);
    @include k-regular-italics;
    @include rem( padding, spacer(1/4) spacer(1/4) );
    backface-visibility: hidden;
    background-image: linear-gradient( black(0), black(.5) );
    background-repeat: repeat-x;
    box-sizing: border-box;
    color: white();
    line-height: 1.25; // No need for vertical rhythm here!
    margin: 0;
    max-height: 85%; // To leave a little room for the overlays at top left and right
    opacity: 0;
    pointer-events: none; // Allows click-through; not compatible with older versions of IE and such; see: http://caniuse.com/#search=pointer-events
    transition: opacity .75s ease-out;
    width: 100%;
    &:before {
      @include k-absolute(left 0 top 0);
      content: "";
      height: 100%;
      min-height: spacer();
      width: 100%;
    }
  }
  &:hover,
  &.no-id:hover {
    #{$overlay},
    .overlay {
      opacity: 1;
      transition: opacity .4s ease;
    }
  }
  &.no-id {
    #{$overlay},
    .overlay {
      opacity: .8; // This class is added when there is no image to display; on these occasions we'd like the title to be visible at all times
      transition: opacity .75s ease-out;
    }
  }
  &.no-fade {
    #{$overlay},
    .overlay {
      opacity: 1; // Always show overlays; apply the `no-fade` class to the parent `figure` element
    }
  }
}
