// ==== MAGNIFIC ==== //

// Adapted from the Magnific Popup source file; @TODO: this still needs a lot of work...

// Magnific settings
$_magnific: (
  image-background: #444
, overlay-color: #FFF
, overlay-opacity: 0.8
, shadow: 2px 2px 7px rgba(0, 0, 0, 0.23)
, visually-hidden: true // Hide content from browsers, but make it available for screen readers
, z-index-base: 1001
);

// A shortcut function to retrieve settings
@function magnific($key) {
  @return config($_magnific, $key);
}

@mixin magnific-popup {
  #page {
    &.blur {
      filter: blur(5px); // Blur the page background; @TODO: animate this?
    }
  }

  // Fixed screen helper
  %mfp-full-screen-fixed {
    @include k-fixed( left 0 top 0 );
    overflow: hidden;
    height: 100%;
    width: 100%;
  }

  // Display none helper
  %mfp-display-none {
    display: none;
  }

  // Transluscent overlay
  .mfp-bg {
    @extend %mfp-full-screen-fixed;
    background: magnific(overlay-color);
    opacity: magnific(overlay-opacity);
    z-index: magnific(z-index-base) + 2;
  }

  // Wrapper for popup
  .mfp-wrap {
    @extend %mfp-full-screen-fixed;
    outline: none !important;
    z-index: magnific(z-index-base) + 3;
    -webkit-backface-visibility: hidden; // Fixes webkit bug that can cause "false" scrollbar
    &::-webkit-scrollbar {
      opacity: 0; // Scrollbar is present but invisible; used to maintain the position of elements
    }
  }

  // Root container
  .mfp-container {
    @extend %wrap; // Extends padding style from the default layout
    @include k-absolute( left 0 top 0 );
    box-sizing: border-box;
    height: 100%;
    text-align: center;
    width: 100%;
    &:before {
      content: '';
      display: inline-block;
      height: 100%;
      vertical-align: middle;
    }
    .mfp-align-top &:before {
      @extend %mfp-display-none; // Remove vertical centering when popup has class `mfp-align-top`
    }
    svg.icon {
      height: spacer(2);
      width: spacer(2);
    }
  }

  // Popup content holder
  .mfp-content {
    display: inline-block;
    margin: 0 auto;
    position: relative;
    text-align: left;
    vertical-align: middle;
    z-index: magnific(z-index-base) + 5;
  }

  // Cursors; @TODO: remove unnecessary bloat here
  .mfp-ajax-cur {
    cursor: progress;
  }
  .mfp-zoom-out-cur {
    &, .mfp-image-holder .mfp-close {
      cursor: -moz-zoom-out;
      cursor: -webkit-zoom-out;
      cursor: zoom-out;
    }
  }
  .mfp-zoom {
    cursor: pointer;
    cursor: -webkit-zoom-in;
    cursor: -moz-zoom-in;
    cursor: zoom-in;
  }
  .mfp-auto-cursor {
    .mfp-content {
      cursor: auto;
    }
  }
  .mfp-close,
  .mfp-arrow,
  .mfp-preloader,
  .mfp-counter {
    -webkit-user-select: none;
    -moz-user-select: none;
    user-select: none;
  }

  // Hide the image during the loading
  .mfp-loading {
    &.mfp-figure {
      @extend %mfp-display-none;
    }
  }

  // Preloader and text that displays error messages
  .mfp-preloader {
    @include k-absolute( top 50% left 8px right 8px );
    text-align: center;
    width: auto;
    z-index: magnific(z-index-base) + 4;
  }

  // Hide preloader when content successfully loaded
  .mfp-s-ready {
    .mfp-preloader {
      @extend %mfp-display-none;
    }
  }

  // Hide content when it was not loaded
  .mfp-s-error {
    .mfp-content {
      @extend %mfp-display-none;
    }
  }

  // Icons
  .mfp-close,
  .mfp-arrow {
    background: transparent;
    border: 0;
    box-shadow: none;
    cursor: pointer;
    display: block;
    outline: none;
    overflow: visible;
    padding: 0;
    z-index: magnific(z-index-base) + 6;
    -webkit-appearance: none;
  }

  // Navigation arrows
  .mfp-arrow {
    @include k-absolute( top 0 );
    display: block;
    height: 100%;
    opacity: .3;
    padding: 0;
    transition: opacity .47s ease-out;
    width: spacer(3);
    -webkit-tap-highlight-color: rgba(0,0,0,0);
    &:hover,
    &:focus {
      opacity: 1;
      transition: opacity .23s ease;
    }
    svg.icon {
      @include k-absolute( top 50% );
      margin: 0;
      margin-top: spacer(-1);
      pointer-events: none;
    }
  }
  .mfp-arrow-left {
    left: 0;
    svg.icon {
      left: spacer(1/2);
    }
  }
  .mfp-arrow-right {
    right: 0;
    svg.icon {
      right: spacer(1/2);
    }
  }

  // Main image in popup
  img {
    &.mfp-img {
      box-sizing: border-box;
      display: block;
      height: auto;
      max-width: 100%;
      line-height: 0;
      margin: 0 auto;
      padding: spacer() 0;
      width: auto;
    }
  }

  .mfp-figure {
    line-height: 0;
    &:after {
      @include k-absolute( top spacer() bottom spacer() left 0 right 0 );
      background: magnific(image-background);
      box-shadow: magnific(shadow);
      content: '';
      display: block;
      height: auto;
      width: auto;
      z-index: -1;
    }
    figure {
      margin: 0;
    }
  }

  .mfp-bottom-bar {
    @include k-absolute( top 100% left 0 );
    cursor: auto;
    margin: spacer(-1) 0;
    width: 100%;
  }
  .mfp-title {
    @include font-size(text-smaller);
    @include k-reverse-italics;
    @include k-text-truncate;
    color: colour(text-lighter); // Not as light as regular captions to account for the blurred background
    padding-right: spacer(1.5); // Leave some space for counter at right side
    text-align: left;
    word-wrap: break-word;
  }
  .mfp-counter {
    @include k-absolute( top 0 right 0 );
    @include font-size(text-smallest);
    color: colour(text-lightest);
    white-space: nowrap;
  }

  // Helper class for hiding stuff
  @if magnific(visually-hidden) {
    .mfp-hide {
      @extend %off-screen;
    }
  } @else {
    .mfp-hide {
      display: none !important;
    }
  }
}
